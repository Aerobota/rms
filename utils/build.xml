<?xml version="1.0" encoding="utf-8"?>
<project name="rms" default="build">
	<property name="src.dir" value="../src" />
	<property name="build.dir" value="../build" />

	<!-- Copy files into the build directory and minify JS -->
	<target name="rebuild">
		<delete dir="${build.dir}" />
		<mkdir dir="${build.dir}" />
		<copy todir="${build.dir}">
			<fileset dir="${src.dir}">
				<include name="**/*" />
				<include name="*" />
			</fileset>
		</copy>
	</target>

	<!-- Run a basic, simple linter -->
	<target name="lint">
		<apply executable="php" failonerror="true">
			<arg value="-l" />
			<fileset dir="${build.dir}">
				<include name="**/*.php" />
				<include name="*.php" />
			</fileset>
		</apply>
	</target>

	<!-- Code quality checks -->
	<target name="quality">
		<phpcodesniffer standard="Zend" showSources="true" haltonerror="true" 
			haltonwarning="true">
			<fileset dir="${build.dir}">
				<include name="study/*.php" />
                <include name="setup/*.php" />
                <include name="menu/*.php" />
                <include name="login/*.php" />
                <include name="js/*.php" />
                <include name="js/**/*.php" />
                <include name="inc/*.php" />
                <include name="img/*.php" />
                <include name="img/**/*.php" />
                <include name="css/*.php" />
                <include name="css/**/*.php" />
                <include name="connection/*.php" />
                <include name="account/*.php" />
                <include name="api/*.php" />
                <include name="api/config/*.php" />
				<include name="*.php" />
			</fileset>
		</phpcodesniffer>
	</target>

	<target name="build" depends="rebuild,lint,quality">
	</target>
</project>
